{% extends 'student_template/base_template.html' %}
{% block title %}
    View {{student}} class Attendance
{% endblock title %}

{% block main_content %}
    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">         
                    <div class="card card-primary">
                        <div class="card-header">
                            <h3 class="card-title" id="attendanceTitle">View Update Attendance</h3>
                        </div>           
                        <div class="card-body">                 
                            <div class="row">                            
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="date">Date</label>
                                        <select class="form-control" id="date" name="date">
                                            {% for attendance in attendances %}
                                                <option value="{{ attendance.id }}">{{ attendance.attendance_date }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-primary btn-block" id="fetch_attendance">Fetch Attendance</button>
                            </div>                          
                        </div>            
                        <div id="student_data" class="card-footer"></div>
                    </div>           
                </div>
            </div>
        </div>
    </section>
    <!-- /.content -->
{% include 'hod_template/datatable.html' %}    
{% endblock main_content %}

{% block customer_js %}
<script>
    $(document).ready(function(){      
        $("#fetch_attendance").click(function() {
            var date = $("#date").val();
               $.ajax({
                url: '{% url 'student_class_attendance_data' %}',
                type: 'POST',
                data: {
                    date: date,                
                },
            })
            .done(function(response) {
                var json_data = JSON.parse(response);
                var selectedDate = $("#date option:selected").text();              
                var cardHtml = "<div class='card card-success'>";
                cardHtml += "<div class='card-header'>" + " Student Attendance on " + selectedDate + "</div>"; // Add card header with class and subject
                cardHtml += "<div class='card-body'>";
                cardHtml += "<div class='table-responsive'><table class='table table-hover text-nowrap table-bordered table-striped table-sm' id='example'><thead><tr><th>Student Name</th><th>Attendance</th></tr></thead><tbody>";
            
                // Generate the student attendance rows in table format
                for (var key in json_data) {
                    cardHtml += "<tr><td>" + json_data[key]['name'] + "</td><td>";
                    
                    // Check if the student's attendance is present or absent and display accordingly
                    if (json_data[key]["status"]) {
                        cardHtml += "<span class='badge badge-success'>Present</span>";
                    } else {
                        cardHtml += "<span class='badge badge-danger'>Absent</span>";
                    }
                    
                    cardHtml += "</td></tr>";
                }
            
                cardHtml += "</tbody></table></div>"; // Close table body and table
                cardHtml += "<div class='form-group'>";              
                cardHtml += "</div>";
                cardHtml += "</div></div>"; // Close card body and card
            
                // Set the card structure to the student_data div
                $("#student_data").html(cardHtml);               
                        
            })
            .fail(function() {
                alert("Error in Fetching Student");
            });
        }); 
             
    })
</script>
{% endblock customer_js %}
